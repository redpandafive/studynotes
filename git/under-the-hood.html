<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Index</title>
    
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/x-icon" href="favicon.ico" />
    <link rel="stylesheet" href="../assets/bootstrap/css/bootstrap.min.css" /><link rel="stylesheet" href="./assets/styles/site.css" />
  </head>
  <body><nav class="navbar navbar-expand-lg bg-light"><div class="container-fluid"><a class="navbar-brand" href="../">Home</a></div></nav>
    <div class="container">
      <h1>Under the Hood</h1><section class="navlinks"><ul><li><a href="./angular/angularcli.html#commands">Commands</a></li></ul></section>

      <section>
        <ul>
          <li>Resembles a file system with versioning added in</li>
          <li>
            At its most basic level, Git is a persistent map between keys and
            values
            <ul>
              <li>Keys are hashes of the file contents</li>
              <li>
                Values are any sequence of bytes - can be a string, file, etc
              </li>
            </ul>
          </li>
          <li>Storage of a repository is done by an object database</li>
        </ul>
      </section>

      <h2>Hashing</h2>
      <section>
        <ul>
          <li>Each object in Git has its own SHA1 hash identifier</li>
          <li>
            Hashs are 20 bytes and consist of 40 character hexadecimal digits
          </li>
          <li>
            Every piece of content generates its own unique hash by its contents
            <ul>
              <li>
                The same sequence of bytes will return the same hash value
              </li>
              <li>
                Hashes are almost impossible to collide for different pieces of
                content, so don't worry about this being an issue
              </li>
            </ul>
          </li>
          <li>
            Hashes are generated by a plumbing function
            <kbd>git hash-object</kbd>
          </li>
        </ul>
      </section>

      <h2>Filesystem Storage</h2>
      <section>
        <ul>
          <li>
            This is stored in a hidden folder named .git in the directiory where
            you initialize the repository
            <ul>
              <li>Git saves objects in the objects subfolder</li>
            </ul>
          </li>
          <li>
            It creates subfolders named using the first two hexadecimal digits
            of the hashed object
          </li>
          <li>
            Inside this subfolder, files are saved for all objects that share
            the first two digits in their identifiers.
            <ul>
              <li>They are named using the remaining digits of the hash</li>
              <li>
                Folder name + filename = SHA1 identifier that belongs to the
                blob
              </li>
            </ul>
          </li>
        </ul>
      </section>

      <h2>File Types</h2>
      <section>
        <ul>
          <li>
            There are 4 types of objects stored as blobs (generic piece of data)
            <ul>
              <li>Commits</li>
              <li>Trees</li>
              <li>Content blobs</li>
              <li>Annotated tags</li>
            </ul>
          </li>
          <li>
            Content blobs represent a file submitted to a commit
            <ul>
              <li>
                Contain a header prepended to the content and compressed to save
                space.
              </li>
              <li>
                The contents of a file are used to generate a unique SHA1 hash
                identifier that is used to reference it
              </li>
              <li>
                Files sent to a commit will have their contents hashed to
                generate a name
              </li>
              <li>
                Note that blobs contains the contents of the committed files,
                not the files themselves
                <ul>
                  <li>
                    The blob will not store the original filename that was sent
                    with the Commit
                  </li>
                  <li>These are stored by Tree objects</li>
                  <li>
                    This allows you to reuse the same blob for multiple files
                    that have the same content (even if they have different
                    filenames)
                  </li>
                </ul>
              </li>
            </ul>
          </li>
          <li>
            Commits are stored as a file in the object database with its own
            SHA1 identifier
            <ul>
              <li>Commits are just a simple and short piece of text</li>
              <li>
                These are also stored in the objects folder by their identifier
              </li>
              <li>
                A commit blob stores
                <ul>
                  <li>Author</li>
                  <li>Committer</li>
                  <li>Date of Commit</li>
                  <li>Commit Message</li>
                  <li>A reference to a hash identifier of a tree object</li>
                  <li>
                    A SHA1 reference to previous commit object (if not an
                    initial commit)
                  </li>
                </ul>
              </li>
              <li>
                Commits will generate different hashes (even if they have the
                same files) since they have different dates and users
              </li>
            </ul>
            <img src="../../assets/commit-explaination-1.png" />
          </li>
          <li>
            Trees are equivalent to a directory
            <ul>
              <li>
                Each directory and subdirectory in your project will create a
                tree
              </li>
              <li>
                Contain a tiny piece of text thats lists the contents of the
                directory
              </li>
              <li>
                Has its own SHA1 identifier and are hashed and stored as blobs
                in the object database using the usual scheme
              </li>
              <li>
                For each subfolder in the project directory, there will be a
                tree reference
                <ul>
                  <li>
                    The original folder name paired with its equivalent tree
                    object identifier
                  </li>
                </ul>
              </li>
              <li>
                For each file in the project directory, there will be an object
                reference
                <ul>
                  <li>
                    This includes the original file name paried with its
                    equivalent content object identifier
                  </li>
                </ul>
              </li>
            </ul>
            <img src="../../assets/commit-explaination-2.png" />
          </li>
          <li>
            In the output, menu.txt and apple_pie.txt have the same SHA1
            identifier
            <ul>
              <li>Both of these files contain the same content</li>
              <li>
                Since the content is the same, they hash to the same value
              </li>
              <li>
                Git doesn't duplicate files if they have the same content, even
                if they have diffrent filenames
              </li>
              <li>
                Since files are stored in trees as associations between an
                identifer and the original name, you can have different
                filenames assigned to the same identifier
              </li>
            </ul>
          </li>
        </ul>
      </section>

      <h2>Versioning</h2>
      <section>
        <ul>
          <li>
            Versioning works by linking together commit objects using hash
            identifiers
            <ul>
              <li>
                Commits are chained together via a parent value that points to
                another commit object key
              </li>

              <li>
                Initial commits do not contain a parent reference since they are
                do not link together
              </li>
              <li>
                Subsequent commits will be stored as seperate blobs in the
                object database using the same process as before
              </li>
            </ul>
          </li>
          <li>
            If the contents of a file is unchanged in the commit, the new commit
            will contain the same SHA1 identifier for the blob
            <ul>
              <li>
                Identifiers that do not have their contents changed by the new
                commit will be reused
              </li>
              <li>
                This is more efficient since you are not storing multiple blobs
                that have the same content
              </li>
            </ul>
          </li>
          <li>
            If a file is changed in the commit, its contents go into the object
            database as a new object
            <ul>
              <li>
                Objets are immutable in Git, so a new blob must be created
              </li>
              <li>
                This will generate a new SHA1 identifier that the commit blob
                will reference
              </li>
              <li>
                If the the object is referenced by a tree blob in the commit,
                Git must also create a new tree object to reference it
              </li>
            </ul>
          </li>
          <li>
            Any change will result in one or more new objects and new
            identifiers to reference
            <ul>
              <li>
                Commits do not alter objects that have been stored in previous
                commits
              </li>
              <li>
                If something changes in the commit, new content blobs and tree
                blobs are created and reference
              </li>
              <li>
                New content blobs will require new tree blobs the reference them
              </li>
              <li>
                The new commit points to a new tree, which points to a list of
                tree blobs (for subdirectories) and content blobs
              </li>
              <img src="../../assets/commit-explaination-4.png" /><br />
            </ul>
          </li>

          <li>
            Git does have optimizations built in once you reach a certain point
            <ul>
              <li>
                This is deep down in implementation details level and can
                usually be ignored
              </li>
              <li>May be relevant if you are working on Git source code</li>
              <li>
                It may switch to storing content differences instead of multiple
                blobs that differ a little bit
              </li>
              <li>
                Could switch to compressing multiple blobs within the same
                physical file
              </li>
              <li>
                Info and pack subfolders in the objects folder are used for this
              </li>
            </ul>
          </li>
        </ul>
      </section>
    </div>
    <script src="../assets/bootstrap/js/bootstrap.bundle.js"></script>
  </body>
</html>
